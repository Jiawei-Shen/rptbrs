(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-scale"),require("@d3fc/d3fc-rebind"),require("d3-time")):"function"==typeof define&&define.amd?define(["exports","d3-scale","@d3fc/d3fc-rebind","d3-time"],b):(a="undefined"==typeof globalThis?a||self:globalThis,b(a.fc=a.fc||{},a.d3,a.fc,a.d3))})(this,function(a,b,c,d){'use strict';function e(){var a={};return a.distance=function(a,b){return b-a},a.offset=function(a,b){return a instanceof Date?new Date(a.getTime()+b):a+b},a.clampUp=function(a){return a},a.clampDown=function(a){return a},a.copy=function(){return a},a}function f(a,b){var c=a.map(b.clampUp);return c.length!==new Set(c.map(function(a){return null===a||void 0===a?void 0:a.valueOf()})).size&&console.warn("There are multiple ticks that fall within a discontinuity, which has led to them being rendered on top of each other. Consider using scale.ticks to explicitly specify the ticks for the scale."),c}function g(a){var d=this;arguments.length||(a=b.scaleIdentity());var h=e(),i=function(b){var c=a.domain(),d=a.range(),e=h.distance(c[0],c[1]),f=h.distance(c[0],b),g=f/e*(d[1]-d[0])+d[0];return g};return i.invert=function(b){var c=a.domain(),d=a.range(),e=(b-d[0])/(d[1]-d[0]),f=h.distance(c[0],c[1]);return h.offset(c[0],e*f)},i.domain=function(){if(!arguments.length)return a.domain();var b=0>=arguments.length?void 0:arguments[0],c=h.clampUp(b[0]),d=h.clampDown(b[1]);return a.domain([c,d]),i},i.nice=function(){a.nice();var b=a.domain(),c=h.clampUp(b[0]),d=h.clampDown(b[1]);return a.domain([c,d]),i},i.ticks=function(){for(var b=arguments.length,c=Array(b),e=0;e<b;e++)c[e]=arguments[e];var g=a.ticks.apply(d,c);return f(g,h)},i.copy=function(){return g(a.copy()).discontinuityProvider(h.copy())},i.discontinuityProvider=function(){return arguments.length?(h=0>=arguments.length?void 0:arguments[0],i):h},c.rebindAll(i,a,c.include("range","rangeRound","interpolate","clamp","tickFormat")),i}function h(a){"@babel/helpers - typeof";return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},h(a)}function i(a,b){return j(a)||k(a,b)||l(a,b)||n()}function j(a){if(Array.isArray(a))return a}function k(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function l(a,b){if(a){if("string"==typeof a)return m(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?m(a,b):void 0}}function m(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=l(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function(){c=a[Symbol.iterator]()},n:function(){var a=c.next();return g=a.done,a},e:function(a){h=!0,f=a},f:function(){try{g||null==c.return||c.return()}finally{if(h)throw f}}}}function p(a){if(1!==arguments.length||"string"!=typeof a)throw"Expected single argument of type string";var b=function(a,b){var c=Number.isInteger;return!!c(a)&&0<=a&&a<=b},c=[0,0,0,0],d=a.split(":");if(2>d.length||3<d.length)throw"Expected an argument wiht 2 or 3 colon delimited parts.";if(c[0]=b(parseInt(d[0],10),23)?parseInt(d[0],10):function(){throw"'Hours' component must be an int between 0 and 23, but was '".concat(d[0],"'")}(),c[1]=b(parseInt(d[1],10),59)?parseInt(d[1],10):function(){throw"'Minutes' component must be an int between 0 and 59, but was '".concat(d[1],"'")}(),3===d.length){var e=d[2].split(".").map(function(a){return parseInt(a,10)});c[2]=b(e[0],59)?e[0]:function(){throw"'Seconds' component must be an int between 0 and 59, but was '".concat(e[0],"'")}(),2===e.length&&(c[3]=b(e[1],999)?e[1]:function(){throw"'Miliseconds' component must be an int between 0 and 999, but was '".concat(e[1],"'")}())}return"".concat(c[0].toString(10).padStart(2,"0"),":").concat(c[1].toString(10).padStart(2,"0"),":").concat(c[2].toString(10).padStart(2,"0"),".").concat(c[3].toString(10).padStart(3,"0"))}function q(a,b){if(2!=arguments.length||!Array.isArray(a)||2!==a.length||"string"!=typeof a[0]||"string"!=typeof a[1])throw"Expected argument is a single string[] of length 2.";"SOD"===a[0]&&(a[0]="00:00:00.000"),"EOD"===a[1]&&(a[1]="00:00:00.000");var c=p(a[0]),d=p(a[1]);if("00:00:00.000"!==d&&c>d)throw"Time range start time '".concat(c,"' must be before end time '").concat(d,"' or both must equal ").concat("00:00:00.000");var e=b.setTime(new Date("00:00:00.000"===d?86400000:0),d)-b.setTime(new Date(0),c),f={startTime:c,endTime:d,lenghtInMs:e};return f.isInRange=function(a){var c=b.getTimeString(a);return!!(f.startTime<=c&&("00:00:00.000"===f.endTime||f.endTime>c))},f}var r=function(a,b,c,d){var e={sunday:0,monday:1,saturday:6},f=86400000,g=5*f,h={},i=function(b){return 0===a(b)||6===a(b)};return h.clampDown=function(c){if(c&&i(c)){var d=b.ceil(c);return a(d)===e.sunday?b.offset(d,-1):a(d)===e.monday?b.offset(d,-2):d}return c},h.clampUp=function(c){if(c&&i(c)){var d=b.floor(c);return a(d)===e.saturday?b.offset(d,2):a(d)===e.sunday?b.offset(d,1):d}return c},h.distance=function(a,b){var d=Math.round;a=h.clampUp(a),b=h.clampDown(b);var e=c.ceil(a);if(b<e)return b.getTime()-a.getTime();var i=e.getTime()-a.getTime(),j=c.ceil(b),k=j.getTime()-b.getTime(),l=d((j.getTime()-e.getTime())/(7*f));return l*g+i-k},h.offset=function(a,e){var f=Math.floor,j=i(a)?h.clampUp(a):a;if(0===e)return j;var k=0>e,l=e,m=k?d.floor(j):c.ceil(j);if(l-=m.getTime()-j.getTime(),k&&0<l||0<e&&0>l)return new Date(j.getTime()+e);j=k?m:b.offset(m,2);var n=f(l/g);return j=b.offset(j,7*n),l-=n*g,j=new Date(j.getTime()+l),j},h.copy=function(){return h},h},s=86400000,t="00:00:00.000",u=function(a,b){var c=a.map(function(a){return q(a,b)}).sort(function(c,a){return c.startTime<a.startTime?-1:c.startTime>a.startTime?1:0}),d=s-c.reduce(function(a,b){return a+b.lenghtInMs},0);return{totalTradingTimeInMiliseconds:d,nonTradingTimeRanges:c,totalTradingMillisecondsBetween:function(a,d){if(a.getTime()===d.getTime())return 0;if(b.dayInterval(a).getTime()!==b.dayInterval(d).getTime()&&b.getStartOfNextDay(a).getTime()!==d.getTime())throw"tradingDay.totalTradingMillisecondsBetween arguments must be on the same day or intervalEnd must be the start of the next day instead: intervalStart: '".concat(a,"'; intervalEnd: '").concat(d,"'");var e,f=0,g=c.filter(function(c){return c.endTime===t||b.setTime(a,c.endTime)>=a}),h=o(g);try{for(h.s();!(e=h.n()).done;){var i=e.value,j=b.setTime(a,i.startTime),k=i.endTime===t?b.getStartOfNextDay(a):b.setTime(a,i.endTime);if(a<j&&d<j)return f+b.msInterval.count(a,d);if(a<j&&(f+=b.msInterval.count(a,j)),d<k)return f;a=k}}catch(a){h.e(a)}finally{h.f()}return f+b.msInterval.count(a,d)},offset:function(a,d){if(0===d)return[a,d];var e=b.msInterval.offset(a,d),f=0<d?c.filter(function(c){return b.setTime(a,c.startTime)>=a}):c.filter(function(c){return b.setTime(a,c.startTime)<a}).reverse();if(0===f.length)return[b.msInterval.offset(a,d),0];if(0<d){var g,h=o(f);try{for(h.s();!(g=h.n()).done;){var i=g.value,j=b.setTime(a,i.startTime);j<=e&&(d-=b.msInterval.count(a,j),a=i.endTime===t?b.getStartOfNextDay(a):b.setTime(a,i.endTime),e=b.msInterval.offset(a,d))}}catch(a){h.e(a)}finally{h.f()}d-=b.msInterval.count(a,e)}else{var k,l=o(f);try{for(l.s();!(k=l.n()).done;){var m=k.value,n=m.endTime===t?b.getStartOfNextDay(a):b.setTime(a,m.endTime);e<n&&(d+=b.msInterval.count(n,a)+1,a=b.msInterval.offset(b.setTime(a,m.startTime),-1),e=b.msInterval.offset(a,d))}}catch(a){l.e(a)}finally{l.f()}d+=b.msInterval.count(e,a)}if(0!==d)throw"tradingDay.offset was called with an offset that spans more than a day";return[e,d]}}},v=function(a,b,c,d,e){var f={};return f.getTimeComponentArrayFromString=function(a){return[a.slice(0,2),a.slice(3,5),a.slice(6,8),a.slice(9,12)]},f.getTimeString=function(a){var b=c(a).map(function(a){return a.toString(10).padStart(2,"0")}),d=i(b,4),e=d[0],f=d[1],g=d[2],h=d[3];return"".concat(e,":").concat(f,":").concat(g,".").concat(h.padStart(3,"0"))},f.setTime=function(b,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,g=f.getTimeComponentArrayFromString(c),h=i(g,4),j=h[0],k=h[1],l=h[2],m=h[3];return e.offset(a(b,j,k,l,m),d)},f.getStartOfNextDay=function(a){return d.offset(d.floor(a),1)},f.getEndOfPreviousDay=function(a){return e.offset(d.floor(a),-1)},f.dayInterval=d,f.msInterval=e,f.getDay=b,f},w=v(function(a,b,c,d,e){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),b,c,d,e)},function(a){return a.getDay()},function(a){return[a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()]},d.timeDay,d.timeMillisecond),x=function(a,b){var c=function(b){return void 0===a[b]?[]:a[b]},d=[u(c("Sunday"),b),u(c("Monday"),b),u(c("Tuesday"),b),u(c("Wednesday"),b),u(c("Thursday"),b),u(c("Friday"),b),u(c("Saturday"),b)],e=d.reduce(function(a,b){return a+b.totalTradingTimeInMiliseconds},0);if(0===e)throw"Trading pattern must yield at least 1 ms of trading time";var f={tradingDays:d,totalTradingWeekMilliseconds:e};return f.clampUp=function(a){var c,e=d[b.getDay(a)],g=o(e.nonTradingTimeRanges);try{for(g.s();!(c=g.n()).done;){var h=c.value;if(h.isInRange(a))return h.endTime===t?f.clampUp(b.getStartOfNextDay(a)):b.setTime(a,h.endTime)}}catch(a){g.e(a)}finally{g.f()}return a},f.clampDown=function(a){var c,e=d[b.getDay(a)],g=o(e.nonTradingTimeRanges);try{for(g.s();!(c=g.n()).done;){var h=c.value;if(h.isInRange(a))return h.startTime===t?f.clampDown(b.getEndOfPreviousDay(a)):b.setTime(a,h.startTime,-1)}}catch(a){g.e(a)}finally{g.f()}return a},f.distance=function(a,c){if(a.getTime()===c.getTime())return 0;var d=a<=c?[a,c,1]:[c,a,-1],e=i(d,3),g=e[0],h=e[1],j=e[2];if(b.dayInterval(g).getTime()===b.dayInterval(h).getTime())return f.tradingDays[b.getDay(g)].totalTradingMillisecondsBetween(g,h);var k=f.tradingDays[b.getDay(g)].totalTradingMillisecondsBetween(g,b.dayInterval.offset(b.dayInterval(g),1))+f.tradingDays[b.getDay(h)].totalTradingMillisecondsBetween(b.dayInterval(h),h);return 1===b.dayInterval.count(g,h)?k:(g=b.dayInterval.offset(b.dayInterval(g),1),h=b.dayInterval(h),j*b.dayInterval.range(g,h).reduce(function(a,c,d,e){var g=d<e.length-1?e[d+1]:b.dayInterval.offset(c,1),h=f.tradingDays[b.getDay(c)];return a+=g-c!==s?h.totalTradingMillisecondsBetween(c,g):h.totalTradingTimeInMiliseconds},k))},f.offset=function(a,c){var d=Math.abs;a=0<=c?f.clampUp(a):f.clampDown(a);var e=function(a){return b.dayInterval.offset(a)-b.dayInterval(a)!==s},g=function(a,c,e){if(0>e){var g=b.dayInterval(c),h=a.totalTradingMillisecondsBetween(g,c);return d(e)<=h?a.offset(c,e):[f.clampDown(b.msInterval.offset(g,-1)),e+h+1]}var i=b.getStartOfNextDay(c),j=a.totalTradingMillisecondsBetween(c,i);return e<j?a.offset(c,e):[f.clampUp(i),e-j]};if(0===c)return a;var h=0>c?function(a,c,d){return[f.clampDown(b.dayInterval.offset(a,-1)),c+d]}:function(a,c,d){return[f.clampUp(b.dayInterval.offset(a)),c-d]},j=f.tradingDays[b.getDay(a)],k=g(j,a,c),l=i(k,2);for(a=l[0],c=l[1];0!==c;)if(j=f.tradingDays[b.getDay(a)],e(a)){var m=g(j,a,c),n=i(m,2);a=n[0],c=n[1]}else{var o=d(c)>=j.totalTradingTimeInMiliseconds?h(a,c,j.totalTradingTimeInMiliseconds):g(j,a,c),p=i(o,2);a=p[0],c=p[1]}return a},f.copy=function(){return f},f},y=v(function(a,b,c,d,e){return new Date(Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),b,c,d,e))},function(a){return a.getUTCDay()},function(a){return[a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()]},d.utcDay,d.utcMillisecond);a.discontinuityIdentity=e,a.discontinuityRange=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=function(a,b){return a>b[0]&&a<b[1]},e=function(a,b){return a[0]>=b[0]&&a[1]<=b[1]},f={};f.distance=function(a,c){a=f.clampUp(a),c=f.clampDown(c);var d=b.filter(function(b){return e(b,[a,c])}),g=d.map(function(a){return a[1]-a[0]});return c-a-g.reduce(function(a,b){return a+b},0)};var g=function(a,b){return a instanceof Date?new Date(a.getTime()+b):a+b};return f.offset=function(a,c){if(0<c){var d=function(){for(var d,e=f.clampUp(a),h=c;0<h;)if(d=b.filter(function(a){return a[0]>e}).sort(function(c,a){return c[0]-a[0]}),d.length){var i=d[0],j=i[0]-e;j>h?(e=g(e,h),h=0):(e=i[1],h-=j)}else e=g(e,h),h=0;return{v:e}}();if("object"===h(d))return d.v}else{var e=function(){for(var d,e=f.clampDown(a),h=c;0>h;)if(d=b.filter(function(a){return a[1]<e}).sort(function(c,a){return a[0]-c[0]}),d.length){var i=d[0],j=i[1]-e;j<h?(e=g(e,h),h=0):(e=i[0],h-=j)}else e=g(e,h),h=0;return{v:e}}();if("object"===h(e))return e.v}},f.clampUp=function(a){return b.reduce(function(a,b){return d(a,b)?b[1]:a},a)},f.clampDown=function(a){return b.reduce(function(a,b){return d(a,b)?b[0]:a},a)},f.copy=function(){return f},f},a.discontinuitySkipUtcWeekends=function(){return r(function(a){return a.getUTCDay()},d.utcDay,d.utcSaturday,d.utcMonday)},a.discontinuitySkipUtcWeeklyPattern=function(a){return x(a,y)},a.discontinuitySkipWeekends=function(){return r(function(a){return a.getDay()},d.timeDay,d.timeSaturday,d.timeMonday)},a.discontinuitySkipWeeklyPattern=function(a){return x(a,w)},a.scaleDiscontinuous=g,Object.defineProperty(a,"__esModule",{value:!0})});
